<div class="container-fluid py-4 page-container">
  <div class="d-flex justify-content-between align-items-center mb-5">
    <div>
      <h2 class="fw-bold text-dark mb-1">
        <span class="text-gradient">Mes Tontines</span>
      </h2>
      <p class="text-muted mb-0">Pilotez vos cercles d'√©pargne</p>
    </div>
    <a routerLink="/tontines/nouvelle" class="btn btn-primary btn-glow">
      <i class="bi bi-plus-lg me-2"></i>Cr√©er une tontine
    </a>
  </div>

  <div class="search-bar-container mb-5">
    <div class="bg-white p-3 rounded-4 shadow-sm search-card">
      <div class="row g-3 align-items-center">
        <div class="col-md-5">
          <div class="input-group-custom">
            <span class="input-icon"><i class="bi bi-search"></i></span>
            <input
              type="text"
              class="form-control"
              [(ngModel)]="recherche"
              placeholder="Rechercher une tontine..."
            />
          </div>
        </div>
        <div class="col-md-3">
          <div class="select-wrapper">
            <select class="form-select" [(ngModel)]="filtreFrequence">
              <option value="tous">üìÖ Toutes fr√©quences</option>
              <option value="journalier">Journalier</option>
              <option value="hebdomadaire">Hebdomadaire</option>
              <option value="mensuel">Mensuel</option>
            </select>
          </div>
        </div>
        <div class="col-md-4 text-end d-flex gap-2 justify-content-end">
          <div class="dropdown">
            <button
              class="btn btn-light fw-bold text-muted dropdown-toggle"
              type="button"
              data-bs-toggle="dropdown"
            >
              <i class="bi bi-sort-down me-2"></i>Trier
            </button>
            <ul class="dropdown-menu dropdown-menu-end shadow-lg border-0 rounded-3">
              <li><a class="dropdown-item" (click)="changerTri('nom')">Nom</a></li>
              <li>
                <a class="dropdown-item" (click)="changerTri('montant_cotisation')">Montant</a>
              </li>
              <li><a class="dropdown-item" (click)="changerTri('date_creation')">Date</a></li>
            </ul>
          </div>
          <button class="btn btn-light btn-icon" (click)="chargerTontines()" title="Actualiser">
            <i class="bi bi-arrow-clockwise"></i>
          </button>
        </div>
      </div>
    </div>
  </div>

  <div *ngIf="chargement" class="text-center my-5 fade-in">
    <div class="spinner-grow text-primary mb-3"></div>
    <p class="text-muted ls-1">Chargement des coffres...</p>
  </div>

  <div *ngIf="!chargement" class="row g-4">
    <div class="col-md-6 col-lg-4 col-xl-3 fade-in-up" *ngFor="let tontine of tontinesFiltrees">
      <div class="card tontine-card h-100 border-0 shadow-sm">
        <div class="card-body p-4 d-flex flex-column">
          <div class="d-flex justify-content-between align-items-start mb-3">
            <div class="icon-box shadow-sm">
              <i [class]="getIconeFrequence(tontine.frequence)"></i>
            </div>
            <span
              class="badge-soft"
              [ngClass]="'badge-soft-' + getCouleurStatut(getStatutTontine(tontine))"
            >
              {{ getStatutTontine(tontine) }}
            </span>
          </div>

          <h5 class="fw-bold text-dark mb-1">{{ tontine.nom }}</h5>
          <p class="text-muted small mb-4 flex-grow-1">
            {{ tontine.description || 'Aucune description disponible.' | slice: 0 : 60 }}...
          </p>

          <div class="metrics-grid mb-4">
            <div class="metric-item">
              <small class="text-muted text-uppercase x-small fw-bold">Cotisation</small>
              <div class="fw-bold text-primary">
                {{ tontine.montant_cotisation | number }} <span class="small">FCFA</span>
              </div>
            </div>
            <div class="metric-item">
              <small class="text-muted text-uppercase x-small fw-bold">Membres</small>
              <div class="fw-bold text-dark">
                {{ tontine.nombre_max_membres }} <span class="small">Max</span>
              </div>
            </div>
          </div>

          <div class="d-grid">
            <a
              [routerLink]="['/tontines', tontine.id]"
              class="btn btn-outline-primary fw-bold rounded-pill"
            >
              G√©rer <i class="bi bi-arrow-right ms-2"></i>
            </a>
          </div>
        </div>
        <div class="card-progress-bar" [style.width]="'60%'"></div>
      </div>
    </div>
  </div>

  <div *ngIf="!chargement && tontinesFiltrees.length === 0" class="text-center py-5">
    <div class="empty-state-icon mb-3">üçÉ</div>
    <h4 class="fw-bold text-dark">C'est calme par ici...</h4>
    <p class="text-muted">Cr√©ez votre premi√®re tontine pour commencer l'aventure.</p>
    <a routerLink="/tontines/nouvelle" class="btn btn-primary btn-glow mt-3">Lancer une tontine</a>
  </div>
</div>
